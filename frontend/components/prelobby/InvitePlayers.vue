<template>
    <SuccessAlert :success="success" />
    <FailureAlert :failed="failed" />
    <button
        class="btn"
        onclick="my_modal_4.showModal()"
        @click="selectLinkText"
    >
        <svg
            class="svg-icon"
            style="
                width: 2em;
                height: 2em;
                vertical-align: middle;
                fill: currentColor;
                overflow: hidden;
            "
            viewBox="0 0 1024 1024"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path
                d="M445.343744 525.346816c-96.13312-47.366144-133.09952-149.192704-108.351488-236.546048 24.864768-87.762944 102.639616-145.75616 194.801664-145.401856 86.628352 0.333824 164.511744 60.598272 188.198912 146.04288 24.3712 87.912448-12.814336 189.353984-109.631488 236.466176 5.20192 1.683456 9.558016 3.196928 13.973504 4.5056 36.612096 10.868736 70.158336 27.89376 101.011456 50.300928 8.415232 6.111232 6.981632 16.175104 4.777984 19.83488-1.867776 3.100672-11.169792 7.90528-20.043776 1.411072-46.485504-34.013184-98.535424-54.110208-155.746304-58.79808-166.172672-13.615104-300.937216 98.162688-333.135872 244.979712-1.386496 6.311936-2.189312 12.752896-3.6352 19.048448-1.970176 8.574976-8.32512 13.268992-16.441344 11.892736-5.834752-0.989184-9.46176-5.6832-9.07264-15.777792 25.847808-139.669504 106.928128-230.600704 241.50016-274.550784 1.611776-0.526336 3.29728-0.825344 4.931584-1.294336 1.927168-0.555008 3.84-1.1776 6.862848-2.113536z m82.825216-9.220096c87.943168 3.52256 173.04576-72.853504 172.818432-172.355584-0.221184-96.72704-76.38016-174.153728-172.378112-174.239744-96.088064-0.086016-172.398592 77.13792-172.83072 173.799424-0.446464 99.612672 84.600832 176.115712 172.3904 172.795904zM767.96928 720.86528c0 28.52864 0.004096 55.47008-0.002048 82.409472-0.002048 13.092864-6.965248 15.839232-12.519424 15.828992-4.984832 0-11.988992-2.699264-11.99104-15.372288-0.008192-27.22816-0.002048-54.458368-0.002048-82.868224h-47.540224c-11.784192 0-23.56224-0.219136-35.340288 0.155648-3.422208 0.108544-7.186432-0.27648-9.975808-2.433024-2.254848-1.742848-3.81952-4.38272-4.624384-7.092224-0.32768-1.107968-0.653312-2.4064-0.653312-3.569664 0-4.347904 3.733504-9.515008 7.763968-10.903552 2.6624-0.915456 5.423104-0.804864 8.194048-0.794624l8.742912 0.026624c5.844992 0.016384 11.689984 0.028672 17.534976 0.04096a22901.66784 22901.66784 0 0 0 55.90016 0.057344v-10.180608c0-23.887872-0.018432-47.775744 0.008192-71.663616 0.012288-11.010048 7.258112-16.044032 12.675072-15.560704 6.549504-0.006144 12.15488 5.824512 11.997184 14.8992-0.464896 26.94144-0.165888 53.895168-0.165888 82.501632h10.02496c24.911872 0 49.829888 0.280576 74.733568-0.14336 7.944192 0.114688 12.62592 7.921664 12.62592 12.169216 0 5.031936-5.193728 12.648448-12.529664 12.589056-24.225792-0.305152-48.457728-0.1024-72.687616-0.100352-3.678208 0.004096-7.354368 0.004096-12.169216 0.004096z"
                fill=""
            />
        </svg>
        Invite players
    </button>
    <dialog id="my_modal_4" class="modal">
        <div class="modal-box">
            <form method="dialog">
                <button
                    class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
                >
                    ✕
                </button>
            </form>
            <h3 class="font-bold text-lg">Invite players</h3>
            <div class="flex flex-row justify-between">
                <input
                    class="input input-bordered w-full max-w-xs mt-3"
                    v-model="link"
                    readonly
                    ref="linkInput"
                />

                <form method="dialog">
                    <button class="btn mt-3 ml-5" @click="copyLink">
                        <svg
                            width="24"
                            height="24"
                            xmlns="http://www.w3.org/2000/svg"
                            fill-rule="evenodd"
                            clip-rule="evenodd"
                            style="fill: currentColor; margin-left: -0.33em"
                        >
                            <path
                                d="M14.851 11.923c-.179-.641-.521-1.246-1.025-1.749-1.562-1.562-4.095-1.563-5.657 0l-4.998 4.998c-1.562 1.563-1.563 4.095 0 5.657 1.562 1.563 4.096 1.561 5.656 0l3.842-3.841.333.009c.404 0 .802-.04 1.189-.117l-4.657 4.656c-.975.976-2.255 1.464-3.535 1.464-1.28 0-2.56-.488-3.535-1.464-1.952-1.951-1.952-5.12 0-7.071l4.998-4.998c.975-.976 2.256-1.464 3.536-1.464 1.279 0 2.56.488 3.535 1.464.493.493.861 1.063 1.105 1.672l-.787.784zm-5.703.147c.178.643.521 1.25 1.026 1.756 1.562 1.563 4.096 1.561 5.656 0l4.999-4.998c1.563-1.562 1.563-4.095 0-5.657-1.562-1.562-4.095-1.563-5.657 0l-3.841 3.841-.333-.009c-.404 0-.802.04-1.189.117l4.656-4.656c.975-.976 2.256-1.464 3.536-1.464 1.279 0 2.56.488 3.535 1.464 1.951 1.951 1.951 5.119 0 7.071l-4.999 4.998c-.975.976-2.255 1.464-3.535 1.464-1.28 0-2.56-.488-3.535-1.464-.494-.495-.863-1.067-1.107-1.678l.788-.785z"
                            />
                        </svg>
                        Copy link
                    </button>
                </form>
            </div>
            <div class="flex justify-center mt-3">
                <button class="btn w-1/3" @click="createQRCode">
                    <svg
                        width="24"
                        height="24"
                        id="Layer_1"
                        data-name="Layer 1"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 122.61 122.88"
                        fill-rule="evenodd"
                        style="fill: currentColor; margin-left: -0.5em"
                    >
                        <title>qr-code-scan</title>
                        <path
                            class="cls-1"
                            d="M26.68,26.77H51.91V51.89H26.68V26.77ZM35.67,0H23.07A22.72,22.72,0,0,0,14.3,1.75a23.13,23.13,0,0,0-7.49,5l0,0a23.16,23.16,0,0,0-5,7.49A22.77,22.77,0,0,0,0,23.07V38.64H10.23V23.07a12.9,12.9,0,0,1,1-4.9A12.71,12.71,0,0,1,14,14l0,0a12.83,12.83,0,0,1,9.07-3.75h12.6V0ZM99.54,0H91.31V10.23h8.23a12.94,12.94,0,0,1,4.9,1A13.16,13.16,0,0,1,108.61,14l.35.36h0a13.07,13.07,0,0,1,2.45,3.82,12.67,12.67,0,0,1,1,4.89V38.64h10.23V23.07a22.95,22.95,0,0,0-6.42-15.93h0l-.37-.37a23.16,23.16,0,0,0-7.49-5A22.77,22.77,0,0,0,99.54,0Zm23.07,99.81V82.52H112.38V99.81a12.67,12.67,0,0,1-1,4.89,13.08,13.08,0,0,1-2.8,4.17,12.8,12.8,0,0,1-9.06,3.78H91.31v10.23h8.23a23,23,0,0,0,16.29-6.78,23.34,23.34,0,0,0,5-7.49,23,23,0,0,0,1.75-8.8ZM23.07,122.88h12.6V112.65H23.07A12.8,12.8,0,0,1,14,108.87l-.26-.24a12.83,12.83,0,0,1-2.61-4.08,12.7,12.7,0,0,1-.91-4.74V82.52H0V99.81a22.64,22.64,0,0,0,1.67,8.57,22.86,22.86,0,0,0,4.79,7.38l.31.35a23.2,23.2,0,0,0,7.5,5,22.84,22.84,0,0,0,8.8,1.75Zm66.52-33.1H96v6.33H89.59V89.78Zm-12.36,0h6.44v6H70.8V83.47H77V77.22h6.34V64.76H89.8v6.12h6.12v6.33H89.8v6.33H77.23v6.23ZM58.14,77.12h6.23V70.79h-6V64.46h6V58.13H58.24v6.33H51.8V58.13h6.33V39.33h6.43V58.12h6.23v6.33h6.13V58.12h6.43v6.33H77.23v6.33H70.8V83.24H64.57V95.81H58.14V77.12Zm31.35-19h6.43v6.33H89.49V58.12Zm-50.24,0h6.43v6.33H39.25V58.12Zm-12.57,0h6.43v6.33H26.68V58.12ZM58.14,26.77h6.43V33.1H58.14V26.77ZM26.58,70.88H51.8V96H26.58V70.88ZM32.71,77h13V89.91h-13V77Zm38-50.22H95.92V51.89H70.7V26.77Zm6.13,6.1h13V45.79h-13V32.87Zm-44,0h13V45.79h-13V32.87Z"
                        />
                    </svg>
                    QR-Code
                </button>
            </div>
            <div class="flex justify-center" :class="{ hidden: !showQRCode }">
                <canvas ref="qrCodeCanvas" class="mt-3"></canvas>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>
</template>

<script setup>
import SuccessAlert from "~/components/prelobby/alerts/SuccessAlert.vue";
import FailureAlert from "~/components/prelobby/alerts/FailureAlert.vue";
import QRCode from "qrcode";

const linkInput = ref(null);
let link = ref("https://www.youtube.com/watch?v=dQw4w9WgXcQ");
let success = ref(false);
let failed = ref(false);

const copyLink = async () => {
    try {
        await navigator.clipboard.writeText(link.value);
        success.value = true;
        setTimeout(() => {
            success.value = false;
        }, 2000);
    } catch (err) {
        failed.value = true;
        setTimeout(() => {
            failed.value = false;
        }, 2000);
    }
};

// Methode zum Auswählen des Textes
const selectLinkText = () => {
    if (linkInput.value) {
        linkInput.value.select();
    }
};

let showQRCode = ref(false);
let qrCodeCanvas = ref(null);

// QR-Code Generator: https://www.npmjs.com/package/qrcode
function createQRCode() {
    showQRCode.value = !showQRCode.value;
    if (showQRCode.value) {
        QRCode.toCanvas(qrCodeCanvas.value, link.value, {
            width: 200,
            height: 200,
        });
    }
}
</script>
